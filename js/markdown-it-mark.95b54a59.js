var f=function(s){function p(n,i){var o,r,k,t,e,l=n.pos,c=n.src.charCodeAt(l);if(i||c!==61||(r=n.scanDelims(n.pos,!0),t=r.length,e=String.fromCharCode(c),t<2))return!1;for(t%2&&(k=n.push("text","",0),k.content=e,t--),o=0;o<t;o+=2)k=n.push("text","",0),k.content=e+e,!(!r.can_open&&!r.can_close)&&n.delimiters.push({marker:c,length:0,jump:o/2,token:n.tokens.length-1,end:-1,open:r.can_open,close:r.can_close});return n.pos+=r.length,!0}function m(n,i){var o,r,k,t,e,l=[],c=i.length;for(o=0;o<c;o++)k=i[o],k.marker===61&&k.end!==-1&&(t=i[k.end],e=n.tokens[k.token],e.type="mark_open",e.tag="mark",e.nesting=1,e.markup="==",e.content="",e=n.tokens[t.token],e.type="mark_close",e.tag="mark",e.nesting=-1,e.markup="==",e.content="",n.tokens[t.token-1].type==="text"&&n.tokens[t.token-1].content==="="&&l.push(t.token-1));for(;l.length;){for(o=l.pop(),r=o+1;r<n.tokens.length&&n.tokens[r].type==="mark_close";)r++;r--,o!==r&&(e=n.tokens[r],n.tokens[r]=n.tokens[o],n.tokens[o]=e)}}s.inline.ruler.before("emphasis","mark",p),s.inline.ruler2.before("emphasis","mark",function(n){var i,o=n.tokens_meta,r=(n.tokens_meta||[]).length;for(m(n,n.delimiters),i=0;i<r;i++)o[i]&&o[i].delimiters&&m(n,o[i].delimiters)})};export{f as m};
